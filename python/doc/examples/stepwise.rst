
Stepwise method
===============

.. code:: python

    import openturns as ot
    import otlmr
    from math import log
    
    sample = ot.NumericalSample.ImportFromTextFile("DATA_test1.csv", ",")
    
    X = sample[:, 1:5]
    R = sample[:, 0]
    
    myLinearModel = ot.NumericalMathFunction(['x1', 'x2', 'x3', 'x4'], ['y'],
        ['14 - 7*x1 - 17*x2 - 7 *x3 - 3*x4 + 13*x3^2 - 16*x4^2 ' +
           ' - 4*x1^2 + 12*x1*x2 + 3*x2*x4 + 13*x3*x4 + 20*x1*x2*x3 ' +
           ' + 17*x1^3 - 10*x2^3 + 7*x4^3'])
    
    Y = myLinearModel(X) + R
    
    ################################################################################################
    # Build a model Y~(X1+X2+X3+X4)^3+I(Xi)^2+I(Xi)^3
    dim = X.getDimension()
    enumerateFunction = ot.EnumerateFunction(dim)
    factory = ot.OrthogonalProductPolynomialFactory([otlmr.MonomialFactory()]*dim, enumerateFunction)
    
    # Build 'interactions' as a list of list [a1,a2,a3,a4], and we will generate tensorized
    # polynomials x1^a1*x2^a2*x3^a3*x4^a4.
    
    # Y ~ (X1+X2+X3+X4)^4
    interactions = [x for x in ot.Tuples([2]*dim).generate()]
    # Remove X1*X2*X3*X4 to obtain Y ~ (X1+X2+X3+X4)^3
    interactions.pop(interactions.index([1]*dim))
    for i in xrange(dim):
      indices = [0]*dim
      indices[i] = 2
      # Y ~ I(Xi)^2
      interactions.append(indices[:])
      # Y ~ I(Xi)^3
      indices[i] = 3
      interactions.append(indices[:])
    
    basis = ot.Basis([factory.build(enumerateFunction.inverse(indices)) for indices in interactions])
    ################################################################################################
    
    i_min = [interactions.index([0,0,0,0])]
    i_0 = i_min[:]
    for i in xrange(dim):
      indices = [0]*dim
      indices[i] = 1
      i_0.append(interactions.index(indices))
    
    #---------------- Forward / Backward------------------- 
    #   X: input sample
    #   basis : Basis
    #   Y: output sample
    #   i_min:  indices of minimal model
    #   direction: Boolean (True FORWARD, False BACKWARD)
    #   penalty: multiplier of number of degrees of freedom
    #   maxiteration: maximum number of iterations
    
    #---------------- Both------------------- 
    #   X: input sample
    #   basis : Basis
    #   Y: output sample
    #   i_min : indices of minimal model
    #   i_0   : indices of start model
    #   penalty: multiplier of number of degrees of freedom
    #   maxiteration: maximum number of iterations
    
    penalty_BIC = log(X.getSize())
    penalty_AIC = 2.
    maxiteration = 1000
    
    for k in [penalty_AIC, penalty_BIC]:
      ## Forward / Backward
      if k==penalty_AIC:  IC =" AIC "
      if k==penalty_BIC:  IC =" BIC "  
      for forward in [True, False]:
        algo = otlmr.LinearModelStepwiseAlgorithm(X, basis, Y, i_min, forward, k, maxiteration)
        algo_result = otlmr.LinearModelAnalysis(algo.getResult())
        print("{0:~^60s}".format(""))
        if forward==True : print(" Forward " +IC)
        else             : print(" Backward "+IC)
        print("{0:~^60s}".format(""))
        print(algo_result)
      ## Both
      algo = otlmr.LinearModelStepwiseAlgorithm(X, basis, Y, i_min, i_0, k, maxiteration)
      algo_result = otlmr.LinearModelAnalysis(algo.getResult())
      print("{0:~^60s}".format(""))
      print(" Both "+IC)
      print("{0:~^60s}".format(""))
      print(algo_result)
    
.. parsed-literal::
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Forward  AIC 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
     Call:
    Basis( [1,x0,x1,(x0) * (x1),x2,(x0) * (x2),(x1) * (x2),(x0) * (x1) * (x2),x3,(x0) * (x3),(x1) * (x3),(x0) * (x1) * (x3),(x2) * (x3),(x0) * (x2) * (x3),(x1) * (x2) * (x3),x0^2,x0^3,x1^2,x1^3,x2^2,x2^3,x3^2,x3^3]#23 )
    
     Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    | 
    ----------------------------------------------------------------------------
    1                  | 10.9814     | 0.65648     | 16.7277     | 1.27112e-28 | 
    x1                 | -3.88875    | 1.9846      | -1.95946    | 0.0533367   | 
    (x0) * (x1)        | 7.18917     | 8.49215     | 0.846566    | 0.399614    | 
    (x0) * (x2)        | 18.6503     | 2.15953     | 8.63624     | 2.94296e-13 | 
    (x0) * (x1) * (x2) | 9.55935     | 0.861055    | 11.1019     | 3.21154e-18 | 
    x3                 | 14.3043     | 1.03648     | 13.8009     | 2.04805e-23 | 
    (x0) * (x3)        | -11.6087    | 1.83235     | -6.33539    | 1.08208e-08 | 
    (x0) * (x1) * (x3) | 9.8174      | 2.11831     | 4.63455     | 1.28003e-05 | 
    (x2) * (x3)        | 5.86969     | 2.9541      | 1.98696     | 0.0501475   | 
    (x0) * (x2) * (x3) | -4.64921    | 1.50572     | -3.0877     | 0.00272418  | 
    x0^3               | 9.9525      | 1.56499     | 6.35948     | 9.73106e-09 | 
    x1^2               | -16.4775    | 3.73193     | -4.41527    | 2.94963e-05 | 
    x1^3               | -16.4804    | 5.66605     | -2.90862    | 0.00463118  | 
    x2^3               | 4.14884     | 1.9234      | 2.15704     | 0.033826    | 
    x3^2               | -3.25933    | 1.65126     | -1.97385    | 0.0516471   | 
    ----------------------------------------------------------------------------
    
     Residual standard error: 0.93463 on 85 degrees of freedom 
     F-statistic: 620.59 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990312 | 
    Adjusted R-squared   | 0.988716 | 
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  | 
    ---------------------------------
    Anderson-Darling     | 0.132184 | 
    Chi-Squared          | 0.562718 | 
    Kolmogorov-Smirnov   | 0.620456 | 
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Backward  AIC 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
     Call:
    Basis( [1,x0,x1,(x0) * (x1),x2,(x0) * (x2),(x1) * (x2),(x0) * (x1) * (x2),x3,(x0) * (x3),(x1) * (x3),(x0) * (x1) * (x3),(x2) * (x3),(x0) * (x2) * (x3),(x1) * (x2) * (x3),x0^2,x0^3,x1^2,x1^3,x2^2,x2^3,x3^2,x3^3]#23 )
    
     Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    | 
    ----------------------------------------------------------------------------
    1                  | 14.4696     | 0.85367     | 16.9499     | 1.10055e-28 | 
    x0                 | -4.96924    | 1.13775     | -4.36761    | 3.6037e-05  | 
    x1                 | -19.6298    | 1.96072     | -10.0115    | 6.24137e-16 | 
    (x0) * (x1)        | 11.8902     | 2.08797     | 5.6946      | 1.82096e-07 | 
    x2                 | -8.79793    | 1.85144     | -4.75195    | 8.3525e-06  | 
    (x1) * (x2)        | 6.52733     | 2.99453     | 2.17975     | 0.0321087   | 
    (x0) * (x1) * (x2) | 13.9549     | 3.1442      | 4.43829     | 2.76759e-05 | 
    x3                 | -10.1758    | 1.96078     | -5.18967    | 1.46874e-06 | 
    (x0) * (x3)        | -5.60052    | 2.132       | -2.62688    | 0.0102606   | 
    (x1) * (x3)        | 10.2331     | 2.74482     | 3.72817     | 0.000351322 | 
    (x2) * (x3)        | 14.3123     | 3.13008     | 4.57249     | 1.66633e-05 | 
    (x0) * (x2) * (x3) | 3.92134     | 3.01451     | 1.30082     | 0.19692     | 
    (x1) * (x2) * (x3) | -8.77332    | 4.2304      | -2.07388    | 0.0411906   | 
    x0^3               | 14.768      | 0.974922    | 15.1479     | 1.30072e-25 | 
    x1^3               | -11.8816    | 0.958026    | -12.4021    | 1.36769e-20 | 
    x2^2               | 14.0536     | 1.33682     | 10.5127     | 6.33754e-17 | 
    x3^3               | -3.25468    | 0.917225    | -3.54839    | 0.000640898 | 
    ----------------------------------------------------------------------------
    
     Residual standard error: 0.88446 on 83 degrees of freedom 
     F-statistic: 607.11 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.991528 | 
    Adjusted R-squared   | 0.989895 | 
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  | 
    ---------------------------------
    Anderson-Darling     | 0.197651 | 
    Chi-Squared          | 0.125636 | 
    Kolmogorov-Smirnov   | 0.482042 | 
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Both  AIC 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
     Call:
    Basis( [1,x0,x1,(x0) * (x1),x2,(x0) * (x2),(x1) * (x2),(x0) * (x1) * (x2),x3,(x0) * (x3),(x1) * (x3),(x0) * (x1) * (x3),(x2) * (x3),(x0) * (x2) * (x3),(x1) * (x2) * (x3),x0^2,x0^3,x1^2,x1^3,x2^2,x2^3,x3^2,x3^3]#23 )
    
     Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    | 
    ----------------------------------------------------------------------------
    1                  | 12.7086     | 0.624644    | 20.3453     | 7.94404e-35 | 
    x0                 | -5.46036    | 1.10552     | -4.93919    | 3.75912e-06 | 
    x1                 | -15.855     | 1.19992     | -13.2134    | 1.65462e-22 | 
    (x0) * (x1)        | -9.23488    | 1.1925      | -7.74411    | 1.63394e-11 | 
    (x0) * (x1) * (x2) | 16.9437     | 1.53474     | 11.0401     | 3.14529e-18 | 
    x3                 | 8.78174     | 0.688698    | 12.7512     | 1.29079e-21 | 
    (x0) * (x3)        | 11.2068     | 1.39616     | 8.02686     | 4.36462e-12 | 
    (x1) * (x3)        | 11.8023     | 1.03538     | 11.399      | 5.99206e-19 | 
    (x2) * (x3)        | -2.95993    | 0.922675    | -3.20799    | 0.00187159  | 
    x0^3               | 4.98183     | 1.18419     | 4.20694     | 6.26974e-05 | 
    x1^3               | 14.1106     | 0.968097    | 14.5756     | 4.49373e-25 | 
    x2^3               | -12.3915    | 0.951199    | -13.0273    | 3.77309e-22 | 
    x3^3               | -2.78756    | 1.28899     | -2.1626     | 0.0333158   | 
    ----------------------------------------------------------------------------
    
     Residual standard error: 0.90426 on 87 degrees of freedom 
     F-statistic: 773.79 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990718 | 
    Adjusted R-squared   | 0.989437 | 
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  | 
    ---------------------------------
    Anderson-Darling     | 0.128032 | 
    Chi-Squared          | 0.317021 | 
    Kolmogorov-Smirnov   | 0.606542 | 
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Forward  BIC 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
     Call:
    Basis( [1,x0,x1,(x0) * (x1),x2,(x0) * (x2),(x1) * (x2),(x0) * (x1) * (x2),x3,(x0) * (x3),(x1) * (x3),(x0) * (x1) * (x3),(x2) * (x3),(x0) * (x2) * (x3),(x1) * (x2) * (x3),x0^2,x0^3,x1^2,x1^3,x2^2,x2^3,x3^2,x3^3]#23 )
    
     Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    | 
    ----------------------------------------------------------------------------
    1                  | 10.3793     | 0.591016    | 17.5618     | 3.48943e-30 | 
    x1                 | -4.29201    | 2.00702     | -2.13849    | 0.0353128   | 
    (x0) * (x1)        | 5.46835     | 8.58833     | 0.636719    | 0.525999    | 
    (x0) * (x2)        | 17.9846     | 2.16866     | 8.29297     | 1.34925e-12 | 
    (x0) * (x1) * (x2) | 9.92345     | 0.85511     | 11.6049     | 2.75263e-19 | 
    (x0) * (x3)        | 14.3108     | 1.05378     | 13.5804     | 4.16424e-23 | 
    (x0) * (x1) * (x3) | -12.4907    | 1.8067      | -6.91358    | 7.84586e-10 | 
    (x2) * (x3)        | 9.36335     | 2.14094     | 4.37347     | 3.41352e-05 | 
    (x0) * (x2) * (x3) | 7.80951     | 2.83236     | 2.75724     | 0.00711774  | 
    x0^3               | -6.96187    | 0.96153     | -7.2404     | 1.76982e-10 | 
    x1^2               | 8.88511     | 1.49311     | 5.95073     | 5.62382e-08 | 
    x1^3               | -16.1115    | 3.78956     | -4.25155    | 5.37021e-05 | 
    x2^3               | -15.1689    | 5.72092     | -2.65148    | 0.00954014  | 
    x3^2               | 4.98412     | 1.9076      | 2.61277     | 0.0105991   | 
    ----------------------------------------------------------------------------
    
     Residual standard error: 0.95024 on 86 degrees of freedom 
     F-statistic: 646.27 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.989867 | 
    Adjusted R-squared   | 0.988336 | 
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  | 
    ---------------------------------
    Anderson-Darling     | 0.384558 | 
    Chi-Squared          | 0.808498 | 
    Kolmogorov-Smirnov   | 0.623556 | 
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Backward  BIC 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
     Call:
    Basis( [1,x0,x1,(x0) * (x1),x2,(x0) * (x2),(x1) * (x2),(x0) * (x1) * (x2),x3,(x0) * (x3),(x1) * (x3),(x0) * (x1) * (x3),(x2) * (x3),(x0) * (x2) * (x3),(x1) * (x2) * (x3),x0^2,x0^3,x1^2,x1^3,x2^2,x2^3,x3^2,x3^3]#23 )
    
     Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    | 
    ----------------------------------------------------------------------------
    1                  | 13.5485     | 0.717251    | 18.8896     | 2.3713e-32  | 
    x0                 | -5.50901    | 1.12662     | -4.88987    | 4.6462e-06  | 
    x1                 | -16.0279    | 1.21304     | -13.2129    | 2.06943e-22 | 
    (x0) * (x1)        | 11.1859     | 1.39804     | 8.00117     | 5.26182e-12 | 
    x2                 | -6.52078    | 1.4938      | -4.36523    | 3.52047e-05 | 
    (x0) * (x1) * (x2) | 17.3258     | 1.54802     | 11.1922     | 1.817e-18   | 
    x3                 | -9.55887    | 1.21411     | -7.87314    | 9.5434e-12  | 
    (x0) * (x3)        | -2.93384    | 1.3133      | -2.23395    | 0.0280807   | 
    (x1) * (x3)        | 5.13282     | 1.22812     | 4.17941     | 6.99762e-05 | 
    (x2) * (x3)        | 12.2915     | 1.27098     | 9.67088     | 2.12107e-15 | 
    x0^3               | 14.2361     | 0.969488    | 14.6842     | 3.72177e-25 | 
    x1^3               | -12.2284    | 0.949904    | -12.8733    | 9.23801e-22 | 
    x2^2               | 13.9612     | 1.3549      | 10.3042     | 1.10315e-16 | 
    x3^3               | -2.96765    | 0.927461    | -3.19976    | 0.00192691  | 
    ----------------------------------------------------------------------------
    
     Residual standard error: 0.90562 on 86 degrees of freedom 
     F-statistic: 712.19 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990797 | 
    Adjusted R-squared   | 0.989405 | 
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  | 
    ---------------------------------
    Anderson-Darling     | 0.434157 | 
    Chi-Squared          | 0.355962 | 
    Kolmogorov-Smirnov   | 0.807624 | 
    ---------------------------------
    
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Both  BIC 
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    
     Call:
    Basis( [1,x0,x1,(x0) * (x1),x2,(x0) * (x2),(x1) * (x2),(x0) * (x1) * (x2),x3,(x0) * (x3),(x1) * (x3),(x0) * (x1) * (x3),(x2) * (x3),(x0) * (x2) * (x3),(x1) * (x2) * (x3),x0^2,x0^3,x1^2,x1^3,x2^2,x2^3,x3^2,x3^3]#23 )
    
     Coefficients:
                       | Estimate    | Std Error   | t value     | Pr(>|t|)    | 
    ----------------------------------------------------------------------------
    1                  | 12.7086     | 0.624644    | 20.3453     | 7.94404e-35 | 
    x0                 | -5.46036    | 1.10552     | -4.93919    | 3.75912e-06 | 
    x1                 | -15.855     | 1.19992     | -13.2134    | 1.65462e-22 | 
    (x0) * (x1)        | -9.23488    | 1.1925      | -7.74411    | 1.63394e-11 | 
    (x0) * (x1) * (x2) | 16.9437     | 1.53474     | 11.0401     | 3.14529e-18 | 
    x3                 | 8.78174     | 0.688698    | 12.7512     | 1.29079e-21 | 
    (x0) * (x3)        | 11.2068     | 1.39616     | 8.02686     | 4.36462e-12 | 
    (x1) * (x3)        | 11.8023     | 1.03538     | 11.399      | 5.99206e-19 | 
    (x2) * (x3)        | -2.95993    | 0.922675    | -3.20799    | 0.00187159  | 
    x0^3               | 4.98183     | 1.18419     | 4.20694     | 6.26974e-05 | 
    x1^3               | 14.1106     | 0.968097    | 14.5756     | 4.49373e-25 | 
    x2^3               | -12.3915    | 0.951199    | -13.0273    | 3.77309e-22 | 
    x3^3               | -2.78756    | 1.28899     | -2.1626     | 0.0333158   | 
    ----------------------------------------------------------------------------
    
     Residual standard error: 0.90426 on 87 degrees of freedom 
     F-statistic: 773.79 ,  p-value: 0
    ---------------------------------
    Multiple R-squared   | 0.990718 | 
    Adjusted R-squared   | 0.989437 | 
    ---------------------------------
    
    ---------------------------------
    Normality test       | p-value  | 
    ---------------------------------
    Anderson-Darling     | 0.128032 | 
    Chi-Squared          | 0.317021 | 
    Kolmogorov-Smirnov   | 0.606542 | 
    ---------------------------------
